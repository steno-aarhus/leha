<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Fie Langmann">
<meta name="author" content="Daniel Borch Ibsen">
<meta name="author" content="Christina Catherine Dahm">
<meta name="dcterms.date" content="2024-01-24">

<title>Protocol: Legume consumption and risk of metabolic dysfunction-associated steatotic liver disease in the UK Biobank Study: a prospective follow-up</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="protocol_files/libs/clipboard/clipboard.min.js"></script>
<script src="protocol_files/libs/quarto-html/quarto.js"></script>
<script src="protocol_files/libs/quarto-html/popper.min.js"></script>
<script src="protocol_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="protocol_files/libs/quarto-html/anchor.min.js"></script>
<link href="protocol_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="protocol_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="protocol_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="protocol_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="protocol_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Protocol: Legume consumption and risk of metabolic dysfunction-associated steatotic liver disease in the UK Biobank Study: a prospective follow-up</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Fie Langmann </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Aarhus University
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    <p class="author">Daniel Borch Ibsen </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Aarhus University
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    <p class="author">Christina Catherine Dahm </p>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Aarhus University
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 24, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="study-information" class="level1">
<h1>Study information</h1>
<section id="legume-consumption-and-risk-of-metabolic-dysfunction-associated-steatotic-liver-disease-in-the-uk-biobank-study-a-prospective-follow-up" class="level2">
<h2 class="anchored" data-anchor-id="legume-consumption-and-risk-of-metabolic-dysfunction-associated-steatotic-liver-disease-in-the-uk-biobank-study-a-prospective-follow-up">Legume consumption and risk of metabolic dysfunction-associated steatotic liver disease in the UK Biobank Study: a prospective follow-up</h2>
</section>
<section id="description" class="level2">
<h2 class="anchored" data-anchor-id="description">Description</h2>
<p>Western diets has been shown to cause a multitude of non-communicable diseases. Metabolic dysfunction-associated steatotic liver disease (MASLD) is the leading chronic disease globally and strongly associated with Western dietary patterns. Based on a combined environmental and health related focus, legumes are increasingly being recommended as a meat substitute, and this study therefore investigates the association between substituting legumes for meats, poultry, and fish and the risk of developing MASLD.</p>
<p>This research will use the UK Biobank Resource under Application Number 81520.</p>
</section>
<section id="objectives-and-hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="objectives-and-hypotheses">Objectives and hypotheses</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">Background</h3>
<p>The EAT-Lancet reference diet was introduced in 2019 as a globally sustainable and healthy diet emphasizing plant-based proteins instead of animal-based proteins, e.g., with a recommendation of 100 g legumes daily <span class="citation" data-cites="RN34411">Willett et al. (<a href="#ref-RN34411" role="doc-biblioref">2019</a>)</span> (1-3). Legume consumption minimizes the risk of metabolic dysfunction-associated steatotic liver disease (MASLD) in animals, by reducing build-up of fats in the liver (10-14). MASLD is the most prevalent chronic liver disease in the Western countries with a prevalence of 15-45 % (15, 16). The disease is caused by Western diets high in red meat, fats, and sugars, obesity, physical inactivity, and smoking (15-18). As legumes are a source of both carbohydrates and proteins, research frequently compare legumes with other carbohydrate sources (9, 34-37). Observed associations for foods may be due the specific foods itself. However, the associations could also represent the effect of the dietary pattern in which the specific food is consumed. When individuals limit intake of certain food groups, they will most often increase the intake of certain other food groups, in an otherwise stable diet (38, 39). The association of such food intake will not only be caused by the increased consumption of one food, but rather the substitution effect including various foods. Replacing protein from animal sources with protein from plant sources has previously been associated with a substantially lower mortality rate and lower risk of MASLD (40, 11). Consumption of legumes in the Western countries has been negligible to date and the impact of markedly increasing intakes of legumes on hepatobiliary and other diseases is understudied. Therefore, this study aims to investigate the effect of replacing meats, poultry, or fish with legumes and the risk of metabolic dysfunction-associated steatohepatitis (MASH) or MASLD contingent on potential confounding factors. As it might be more feasible for Western populations to include legumes and substituting dietary components that are not meats, this study will also aim to investigate the effect of a non-specific substitution of dietary non-meat components for legumes on the risk of MASLD and MASH.</p>
<p><strong>Hypothesis</strong></p>
<ul>
<li><p>Replacing meats and poultry intakes with legumes is associated with a lower risk of MASLD and MASH.</p></li>
<li><p>Replacing fish intake with legumes is not associated with a lower risk of MASLD and MASH.</p></li>
<li><p>Replacing non-specific foods with legumes is not associated with a lower risk of MASLD and MASH.</p></li>
</ul>
</section>
</section>
</section>
<section id="design-plan" class="level1">
<h1>Design plan</h1>
<section id="study-type" class="level2">
<h2 class="anchored" data-anchor-id="study-type">Study type</h2>
<p><strong>Observational Study</strong>. Data is collected from study subjects that are not randomly assigned to a treatment. This includes surveys, natural experiments, and regression discontinuity designs.</p>
</section>
<section id="blinding" class="level2">
<h2 class="anchored" data-anchor-id="blinding">Blinding</h2>
<p>No blinding is involved in this study.</p>
</section>
<section id="study-design" class="level2">
<h2 class="anchored" data-anchor-id="study-design">Study design</h2>
<p><strong>Study population and setting</strong></p>
<p>The initial recruitment of participants for the UK Biobank started in 2006 and ran until June 2010. Of 9.2 million people identified from the National Health Service registers and invited to participate in the study, 5.5% participated, approximately 500,000 participants, aged 37-73 years at baseline. The study protocol and more information are available elsewhere (41, 42). All participants gave written, informed consent prior to baseline, and the study was approved by the National Information Governance Board for Health and Social Care and the National Health Service North West Multicentre Research Ethics Committee (reference number 06/MRE08/65).</p>
</section>
</section>
<section id="sampling-plan" class="level1">
<h1>Sampling plan</h1>
<section id="existing-data" class="level2">
<h2 class="anchored" data-anchor-id="existing-data">Existing data</h2>
<p><strong>Registration prior to analysis of the data</strong></p>
<p>As of the date of submission, the data exist and you have accessed it, though no analysis has been conducted related to the research plan (including calculation of summary statistics). A common situation for this scenario when a large dataset exists that is used for many different studies over time, or when a data set is randomly split into a sample for exploratory analyses, and the other section of data is reserved for later confirmatory data analysis.</p>
</section>
<section id="explanation-of-existing-data" class="level2">
<h2 class="anchored" data-anchor-id="explanation-of-existing-data">Explanation of existing data</h2>
<p>The UK Biobank is a large national cohort of participants in the UK, with data collected in a standardized format the the sole purpose of providing a data resource for researchers to use for health research. All information about collection procedures, limitations, and sources of bias are well established and described by the UK Biobank resource.</p>
<p>Because of its size of data collected, it is near impossible to a priori see patterns in the data that might influence how the analysis will be conducted, unless specifically looked for or previously published on. In this way, we feel pre-analysis bias is minimal.</p>
</section>
<section id="data-collection-procedures" class="level2">
<h2 class="anchored" data-anchor-id="data-collection-procedures">Data collection procedures</h2>
<p><strong>Study population and setting</strong></p>
<p>At baseline, participants provided detailed information on several sociodemographic, physical, lifestyle, and health-related characteristics via self-completed touch-screen questionnaires and a computer assisted personal interview (43). Professionally trained staff did physical, anthropometric, and biomedical measures following standardized procedures (41). Diet was assessed through a touchscreen questionnaire at baseline and a 24-hour dietary assessment tool designed for the UK Biobank study. The 24-hour dietary assessment tool was completed by participants up to five times and 210,965 individuals completed one or more 24-hour dietary assessments (44).</p>
<p><strong>Assessment of diet</strong></p>
<p>The Oxford WebQ was designed as an internet based 24-hour dietary assessment tool for measuring diet on repeated occasions. The questionnaire is a short set of food frequency questions on commonly eaten food groups in the British population on the day before. The questionnaire aims to measure the type and quantity of food and beverages consumed in the last 24 hours and estimate nutrients from the entered information through the UK Nutrient Databank Food Composition Tables (45, 46). The Oxford WebQ was compared with interviewer administered 24-hour dietary recalls and validated for macronutrients and total energy intake using recovery biomarkers and comparing with a single food frequency questionnaire (45, 47, 48). Recently, the Oxford WebQ nutrient calculation was updated to provide more detailed information on nutrient intakes and to incorporate new dietary variables (46). Participants recruited between April 2009 and September 2010 completed the Oxford WebQ at baseline (n=70,747). The Oxford WebQ was not available until April 2009 and participants recruited before that date who provided a valid email address were invited to complete the four subsequent 24-hour dietary assessments online (49).</p>
<p><strong>Legumes</strong></p>
<p>Legume consumption will be estimated based on participants reported diets from the self-administered online 24-hour dietary assessments, the Oxford WebQ. Consumption of legumes and pulses will be based on total weight by food group intakes estimated from participants’ responses in the Oxford WebQ. Despite the high detail level of the Oxford WebQ, a single 24-hour dietary assessment cannot capture habitual intake of legumes in a UK-setting (50). Therefore, this study will include varying numbers of 24-hour dietary assessments to ensure that we capture usual intake of legumes. Usual intake will be estimated as a daily average across available 24-hour dietary assessments.</p>
<p><strong>Meat, poultry, and fish</strong></p>
<p>Consumption of red and processed meats, poultry, and fish will be based on total weight by food group intakes estimated from participants’ responses to the Oxford WebQs. Red and processed meat will be defined as beef, pork, lamb, and other meats including offal, and processed meat including sausages, bacon, ham, and liver paté. Poultry will be defined as poultry with or without skin, and fried poultry with batter or breadcrumbs. Fish will be defined as oily fish, white fish and tinned tuna, fried fish with batter or breadcrumbs, and shellfish.</p>
<p><strong>Metabolic dysfunction-associated steatotic liver disease</strong></p>
<p>Incident cases of MASH and MAFLD will be assessed through linkage to the National Health Service registers where diagnosis after hospital admission or primary care visits are coded according to the International Classification of Diseases and Related Health Problems (ICD-10) (51). MASLD was previously known as non-alcoholic fatty liver disease (NAFLD), but the nomenclature was changed in 2023 to shift focus towards the metabolic factors underlying the disease and not merely the lack of alcohol consumption and to aid the prevention and early diagnoses of MASLD (22). Due to this change in nomenclature, incident cases of MASLD are diagnosed based on ICD-10-code for NAFLD, K76.0, at first admission to hospital, while incident cases of MASH are diagnosed based on ICD-10-code for NASH, K75.8 (52).</p>
<p><strong>Covariates</strong></p>
<p>Directed acyclic graphs were used to illustrate the potential and known association between covariates of the association between substituting meat, poultry or fish for legumes and development of MAFLD and MASH. Information on covariates will include information on all other dietary components based on total weight by food group intakes as g/day and kcal/day retrieved from the Oxford WebQ (fruits, vegetables, cereal products, dairy products, egg products, nuts, mixed dishes, condiments, added sugar and sweets, non-alcoholic beverages, and alcoholic beverages), sex (male, female), age (years), alcohol consumption (g ethanol/day as restricted cubic splines), ethnic group (white, mixed background, Asian, black, other, and unknown), socioeconomic status (Townsend deprivation score [quintiles], educational level), geographical region of recruitment (ten UK regions), lives with a wife or partner (yes, no), anthropometry (BMI [kg/m2]), physical activity (low [0-9.9 METs/week], moderate [10-49.9 METs/week], and high [≥50 METs/week], unknown), smoking status (never, former, current 1-15 cigarettes per day, current ≥15 cigarettes per day, current but number of cigarettes per day unknown, and smoking status unknown); metabolic risk factors (and self-reported [yes, no, unknown] diagnoses of diabetes, hypertension, and high cholesterol).</p>
</section>
<section id="sample-size" class="level2">
<h2 class="anchored" data-anchor-id="sample-size">Sample size</h2>
<p>For this cohort study, only participants with two or more 24 h dietary assessments will be included in the analyses, while missing information on covariates will be filled in by statistical imputations where applicable. Individuals with alcohol intakes exceeding the 90th percentile will be excluded from the study to mitigate the risk of misclassifying the outcome by eliminating those with alcoholic fatty liver disease.</p>
</section>
<section id="sample-size-rationale" class="level2">
<h2 class="anchored" data-anchor-id="sample-size-rationale">Sample size rationale</h2>
</section>
</section>
<section id="variables" class="level1">
<h1>Variables</h1>
<section id="measured-variables" class="level2">
<h2 class="anchored" data-anchor-id="measured-variables">Measured variables</h2>
<p><strong>Exposures:</strong> g/day and kcal/day consumption of legumes, meats, poultry, and fish</p>
<p><strong>Outcomes:</strong> metabolic dysfunction-associated fatty liver disease (MAFLD) and metabolic dysfunction-associated steatohepatitis (MASH)</p>
<p><strong>Covariates:</strong> g/day and kcal/day consumption of fruits, vegetables, cereal products, dairy products, egg products, nuts, mixed dishes, condiments, added sugar and sweets, non-alcoholic beverages, and alcoholic beverages. Sex, age, ethnic group, Townsend deprivation score, educational level, geographical region of recruitment (ten UK regions), lives with a wife or partner, BMI, physical activity, smoking status, and self-reported diabetes, hypertension, and high cholesterol.</p>
</section>
</section>
<section id="analysis-plan" class="level1">
<h1>Analysis plan</h1>
<section id="statistical-models" class="level2">
<h2 class="anchored" data-anchor-id="statistical-models">Statistical models</h2>
<section id="main-analyses" class="level3">
<h3 class="anchored" data-anchor-id="main-analyses">Main analyses</h3>
<p>Standard summary statistics will be performed to describe the distribution of total legume consumption as an average g/day based on participants’ 24-h WebQ responses and across baseline characteristics of participants in the study. Multi-variable adjusted Cox Proportional Hazards regression models will be used to estimate the hazard ratios for each of the outcomes based on replacing meats, poultry, or fish with legumes.</p>
<ul>
<li><p>Replacing red and processed meats, poultry, or fish with legumes (e.g., per 30 g/day)</p></li>
<li><p>Replacing red and processed meats, poultry, or fish with legumes (e.g., per 40 kcal/day)</p></li>
</ul>
<p>Age will be used as the underlying time scale in the analyses. Follow-up time will begin with participants’ last completed Oxford WebQ. As participants in UKB are still followed-up today, participants will be right censored at the date of the most recent registry update of full follow-up for the outcomes. Otherwise, censoring will occur at the event of death, loss to follow-up from the study, or date of diagnosis of MASLD or MASH, whichever comes first. The substitution analyses will be conducted with different adjustment levels.</p>
<p><strong>Model 1</strong> will be minimally adjusted for strata of age at recruitment (&lt;45, 45-49, 50-54, 55-59, 60-64, ≤65 years) and geographical region of recruitment (ten UK regions), sex, and intake of all other dietary components apart from the substitute components (red and processed meats; poultry; fish). When substituting g legumes/day, the unit for all dietary components will be g/day and the analyses will be adjusted for total amount of consumed foods in g/day. When substituting calories of legumes, the unit for all dietary components will be calories/day and the analyses will be adjusted for total amount of consumed calories/day.</p>
<p><strong>Model 2</strong> will be further adjusted for alcohol consumption, ethnic group (white, mixed, Asian, black, other, unknown), socioeconomic status (Townsend deprivation score, educational level), living with a wife or partner (yes, no), physical activity (low [0-9.9 METs/week], moderate [10-49.9 METs/week], and high [≥50 METs/week], unknown), smoking status (never, former, current 1-15 cigarettes per day, current ≥15 cigarettes per day, current but number of cigarettes per day unknown, and smoking status unknown), and self-reported diagnosis of diabetes, hypertension, or high cholesterol (yes, no, unknown).</p>
<p><strong>Model 3</strong> will further adjust for anthropometry (BMI ≥ 30 kg/m2), as obesity may either confound or mediate the association between replacing red and processed meats, poultry, or fish with legumes and risk of MASLD</p>
</section>
<section id="secondary-and-sensitivity-analyses" class="level3">
<h3 class="anchored" data-anchor-id="secondary-and-sensitivity-analyses">Secondary and sensitivity analyses</h3>
<p>To evaluate the association between overall legume intake and hepatobiliary disease risk, quintiles of legume intake (g/day) will be evaluated with adjustment levels similar to the substitution models.</p>
<p>Peas are increasingly used as a plant-based meat alternative in the food industry (53). Despite this, peas are also included in the NHS 5 A Day recommendations for fruits and vegetables consumption in the UK (54). Therefore, in secondary analyses consumption of legumes will include participants self-reported intake of legumes and pulses together with consumed peas. The amount of peas consumed will be estimated based on participants’ reported daily portions consumed with a portion size of peas weighing 80 g (55).</p>
<p>To evaluate the robustness of the main analyses, sensitivity analyses will include varying numbers of Oxford WebQ returns, and removal of participants with increased serum levels of alanine-aminotransferase (&gt;45 U/L for women and &gt;70 U/L for men) and aspartate-aminotransferase (&gt;35 U/L for women and &gt;45 U/L for men). Sensitivity analyses will further include removal of participants in the highest 10% percentile of alcohol intake and removal of those with previous diseases of the liver, although not necessarily MAFLD, as they may be predisposed for developing further liver diseases.</p>
<p>All analyses will be conducted in R with a significance level of 5%.</p>
</section>
</section>
<section id="transformations" class="level2">
<h2 class="anchored" data-anchor-id="transformations">Transformations</h2>
</section>
<section id="inference-criteria" class="level2">
<h2 class="anchored" data-anchor-id="inference-criteria">Inference criteria</h2>
<p>All analyses will be evaluated based on two-sided p-values. Values below 5% are classified as statistically significant. Inference on relevance and significance and the evaluation of, whether a result is meaningful will be based on the size of the estimate, confidence intervals containing 1 or 0, for ratios or absolute measures respectively.</p>
</section>
<section id="data-exclusion" class="level2">
<h2 class="anchored" data-anchor-id="data-exclusion">Data exclusion</h2>
</section>
<section id="missing-data" class="level2">
<h2 class="anchored" data-anchor-id="missing-data">Missing data</h2>
</section>
<section id="exploratory-analyses-optional" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-analyses-optional">Exploratory analyses (optional)</h2>
</section>
</section>
<section id="other" class="level1">
<h1>Other</h1>
<p><em>add the references here</em></p>
</section>
<section id="references" class="level1 unnumbered">


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-RN34411" class="csl-entry" role="listitem">
Willett, W., J. Rockström, B. Loken, M. Springmann, T. Lang, S. Vermeulen, T. Garnett, et al. 2019. <span>“Food in the Anthropocene: The EAT-Lancet Commission on Healthy Diets from Sustainable Food Systems.”</span> Journal Article. <em>Lancet</em> 393 (10170): 447–92. https://doi.org/<a href="https://doi.org/10.1016/s0140-6736(18)31788-4">https://doi.org/10.1016/s0140-6736(18)31788-4</a>.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>